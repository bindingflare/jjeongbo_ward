<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="개인정보와드 ? 개인정보동의서를 분석해 제3자 제공, 민감정보, 보유기간, 마케팅 활용 등을 점수로 알려주는 무료 서비스.">
        <meta name="author" content="개인정보와드">

        <title>개인정보와드 | 분석 결과 카드</title>

        <link rel="icon" type="image/webp" href="images/favicon.webp" sizes="32x32">

        <!-- CSS FILES -->
        <link rel="preconnect" href="https://fonts.googleapis.com">

        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        
        <!-- Fonts: Keep JP for headings, use KR for body -->
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;300;400;700;900&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">

        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/bootstrap-icons.css" rel="stylesheet">

        <link rel="stylesheet" href="css/magnific-popup.css">

        <link href="css/aos.css" rel="stylesheet">

        <link href="css/templatemo-nomad-force.css" rel="stylesheet">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8822573820904938" crossorigin="anonymous"></script>
    </head>
    
    <body data-auto-analyze="true">
        <main>
            <div class="container my-4">
                <div class="row">
                    <div class="col-12 d-flex justify-content-center">
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-8822573820904938"
                            data-ad-slot="0000000000"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                    </div>
                </div>
            </div>
            <div id="analysisError" class="container my-4 d-none">
                <div class="row">
                    <div class="col-12">
                        <div class="alert alert-warning text-center mb-0 d-flex justify-content-center align-items-center gap-3 py-4 fs-5" role="alert">
                            <i class="bi-emoji-frown text-primary fs-2" aria-hidden="true"></i>
                            <span class="fw-bold">잘못된 접근입니다</span>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display:none;" aria-hidden="true">
                <textarea id="consentText"></textarea>
                <button id="analyzeBtn" type="button">자동 분석 트리거</button>
            </div>
            <section class="section-padding" id="analysis-card">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-8 col-12 mx-auto mt-4" data-aos="fade-up" data-aos-delay="250">
                            <div id="analysisResult" class="card border-0 shadow-sm d-none">
                                <div class="card-body">
                                    <h5 class="mb-3">분석 결과</h5>
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="me-3">
                                            <div id="riskMeter" class="water-meter" aria-label="위험도 수치">
                                                <div class="water"></div>
                                                <span id="riskScore">--</span>
                                            </div>
                                        </div>
                                        <div>
                                            <div id="riskLabel" class="fw-bold">-</div>
                                            <small class="text-muted">0(낮음) ~ 100(높음)</small>
                                        </div>
                                    </div>
                                    <ul id="riskBullets" class="mt-3 mb-0"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <div class="container my-4">
                <div class="row">
                    <div class="col-12 d-flex justify-content-center">
                        <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-8822573820904938"
                            data-ad-slot="1111111111"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                    </div>
                </div>
            </div>
        </main>

        <!-- JAVASCRIPT FILES -->
        <script src="js/jquery.min.js"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script src="js/jquery.sticky.js"></script>
        <script src="js/aos.js"></script>
        <script src="js/jquery.magnific-popup.min.js"></script>
        <script src="js/magnific-popup-options.js"></script>
        <script src="js/scrollspy.min.js"></script>
        <script src="js/custom.js"></script>
        <script src="js/analysis-result.js"></script>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        <script>
            (function () {
                var ta;
                var btn;
                var err;
                var alreadyRan = false;

                function hideError() { if (err) err.classList.add('d-none'); }
                function showError() { if (err) err.classList.remove('d-none'); }

                function runAnalysisFromPayload(payload) {
                    if (alreadyRan) return true;
                    if (!payload) return false;
                    var meta = payload.meta || {};
                    var text = meta.originalText || payload.originalText || payload.text || meta.text || '';
                    var endpoint = meta.fullLink || payload.fullLink || payload.endpoint || meta.endpoint;
                    text = (text || '').trim();
                    console.debug('[analysis-result] payload received', {
                        hasMeta: !!payload.meta,
                        endpoint: endpoint || '(none)',
                        textLength: text.length
                    });
                    if (!text) return false;
                    if (endpoint) window.__wardAnalysisEndpointOverride = endpoint;
                    hideError();
                    if (ta) ta.value = text;
                    if (btn) btn.click();
                    alreadyRan = true;
                    return true;
                }

                function trySessionPayload() {
                    try {
                        var raw = sessionStorage.getItem('analysisPayload');
                        if (!raw) return false;
                        var parsed = JSON.parse(raw);
                        return runAnalysisFromPayload(parsed);
                    } catch (e) {
                        return false;
                    }
                }

                window.addEventListener('message', function (event) {
                    if (runAnalysisFromPayload(event && event.data)) return;
                });

                window.addEventListener('load', function () {
                    ta = document.getElementById('consentText');
                    btn = document.getElementById('analyzeBtn');
                    err = document.getElementById('analysisError');

                    // Data-based flow: pass payload via sessionStorage
                    if (runAnalysisFromPayload(history.state)) return;
                    if (trySessionPayload()) return;

                    // If nothing is provided yet, show an error until a postMessage arrives
                    showError();
                });
            })();
        </script>
    </body>
</html>
